<Window x:Class="TextFilter.DisplayAllFile"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:local="clr-namespace:TextFilter"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Trace Message"
        Width="605"
        Height="400"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <local:TextFilterSettings x:Key="settings" />
        <local:MainViewModel x:Key="mainViewModel" />
        <local:FilterTabViewModel x:Key="filterTabViewModel" />
        <local:LogTabViewModel x:Key="logTabViewModel" />
        <local:LogViewModel x:Key="logViewModel" />
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Grid Background="{Binding Source={StaticResource settings}, Path=Settings.BackgroundColor}">
        <!--   <DataTemplate> -->
        <DataGrid x:Name="logFileData"
                                  Margin="0,0,0,0"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  AutoGenerateColumns="False"
                                  Background="{Binding Source={StaticResource settings},
                                                       Path=Settings.BackgroundColor}"
                                  BorderBrush="{Binding Source={StaticResource settings},
                                                        Path=Settings.ForegroundColor}"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  GridLinesVisibility="None"
                                  IsReadOnly="False"
                                  ItemsSource="{Binding Path=ContentItems}"
                                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  SelectionMode="Extended"
                                  SelectionUnit="FullRow"
                                  Tag="{Binding}"
                                  VirtualizingStackPanel.IsVirtualizing="True"
                                  VirtualizingStackPanel.VirtualizationMode="Recycling">
            <!--ItemsSource="{Binding Source=logViewModel, Path=SelectedTab.ContentList}"-->
            <DataGrid.Resources>
                <local:BindingProxy x:Key="proxyLog"
                                                    Data="{Binding}" />
            </DataGrid.Resources>

            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Style.Setters>
                        <Setter Property="Background"
                                                Value="{Binding Path=Background}" />
                        <Setter Property="Foreground"
                                                Value="{Binding Path=Foreground}" />
                        <Setter Property="FontSize"
                                                Value="{Binding Source={StaticResource settings}, Path=Settings.FontSize}" />
                        <Setter Property="FontFamily"
                                                Value="{Binding Source={StaticResource settings}, Path=Settings.FontName}" />
                        <Setter Property="BorderThickness"
                                                Value="1" />
                        <Setter Property="BorderBrush"
                                                Value="{Binding Path=Background}" />
                    </Style.Setters>
                    <Style.Triggers>
                        <Trigger Property="IsSelected"
                                                 Value="True">
                            <Setter Property="BorderBrush"
                                                    Value="{Binding Path=Foreground}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>

            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Path=FilterIndex}"
                                                    Header="FilterIndex"
                                                    Visibility="{Binding Data.FilterIndexVisibility,
                                                                         Source={StaticResource proxyLog},
                                                                         Converter={StaticResource BoolToVis}}" />

                <DataGridTextColumn Binding="{Binding Path=Index}"
                                                    Header="Index"
                                                    SortDirection="Ascending" />
                <DataGridTextColumn Width="{Binding Source={StaticResource settings},
                                                                    Path=Settings.ContentColumnSize}"
                                                    Binding="{Binding Path=Content}"
                                                    Header="Content">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping"
                                                    Value="{Binding Source={StaticResource settings}, Path=Settings.WordWrapString}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <Setter Property="ContextMenu">
                                <Setter.Value>
                                    <ContextMenu>
                                    </ContextMenu>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Width="50*"
                                                    Binding="{Binding Path=Group1}"
                                                    Header="Group1"
                                                    Visibility="{Binding Data.Group1Visibility,
                                                                         Source={StaticResource proxyLog},
                                                                         Converter={StaticResource BoolToVis}}">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping"
                                                    Value="{Binding Source={StaticResource settings}, Path=Settings.WordWrapString}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Width="50*"
                                                    Binding="{Binding Path=Group2}"
                                                    Header="Group2"
                                                    Visibility="{Binding Data.Group2Visibility,
                                                                         Source={StaticResource proxyLog},
                                                                         Converter={StaticResource BoolToVis}}">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping"
                                                    Value="{Binding Source={StaticResource settings}, Path=Settings.WordWrapString}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Width="50*"
                                                    Binding="{Binding Path=Group3}"
                                                    Header="Group3"
                                                    Visibility="{Binding Data.Group3Visibility,
                                                                         Source={StaticResource proxyLog},
                                                                         Converter={StaticResource BoolToVis}}">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping"
                                                    Value="{Binding Source={StaticResource settings}, Path=Settings.WordWrapString}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Width="50*"
                                                    Binding="{Binding Path=Group4}"
                                                    Header="Group4"
                                                    Visibility="{Binding Data.Group4Visibility,
                                                                         Source={StaticResource proxyLog},
                                                                         Converter={StaticResource BoolToVis}}">
                    <DataGridTextColumn.ElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping"
                                                    Value="{Binding Source={StaticResource settings}, Path=Settings.WordWrapString}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SourceUpdated">
                    <i:InvokeCommandAction Command="{Binding SourceUpdatedCommand}"
                                                           CommandParameter="{Binding ElementName=logFileData}" />
                </i:EventTrigger>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding SelectionChangedCommand}"
                                                           CommandParameter="{Binding ElementName=logFileData}" />
                </i:EventTrigger>
                <i:EventTrigger EventName="LayoutUpdated">
                    <i:InvokeCommandAction Command="{Binding SetViewerCommand}"
                                                           CommandParameter="{Binding ElementName=logFileData}" />
                </i:EventTrigger>
                <i:EventTrigger EventName="PreviewKeyDown">
                    <i:InvokeCommandAction Command="{Binding KeyDownCommand}"
                                                           CommandParameter="{Binding}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <DataGrid.InputBindings>
                <KeyBinding Key="C"
                                            Command="{Binding CopyCommand}"
                                            Modifiers="Control" />
                <KeyBinding Command="{Binding Source={StaticResource mainViewModel},
                                                              Path=LogViewModel.FindPreviousCommand}"
                                            CommandParameter="{Binding}"
                                            Gesture="Shift+F3" />
                <KeyBinding Command="{Binding Source={StaticResource mainViewModel},
                                                              Path=LogViewModel.FindNextCommand}"
                                            CommandParameter="{Binding}"
                                            Gesture="F3" />
                <KeyBinding Key="A"
                                            Modifiers="Control+Shift"
                                            Command="{Binding Source={StaticResource mainViewModel},
                                                                Path=FilterViewModel.InsertFilterItemFromTextCommand}"
                                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                <KeyBinding Key="N"
                                            Modifiers="Control+Shift"
                                            Command="{Binding Source={StaticResource mainViewModel},
                                                                Path=FilterViewModel.NewFromTextCommand}"
                                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                <KeyBinding Key="Q"
                                            Modifiers="Control+Shift"
                                            Command="{Binding Source={StaticResource mainViewModel},
                                                                Path=FilterViewModel.QuickFindTextCommand}"
                                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}}" />
            </DataGrid.InputBindings>
            <DataGrid.ContextMenu>
                <ContextMenu HasDropShadow="True">
                </ContextMenu>
            </DataGrid.ContextMenu>
        </DataGrid>
        <!-- </DataTemplate> -->
    </Grid>
</Window>